let portfolioData=null,activeWalletId=null;const SELECTORS={portfolioValue:"#portfolio-value",chartValue:"#chart-value",portfolioStat:"#portfolio-stat-value",winrateStat:"#winrate-value",annualReturnStat:"#annual-return-value",yearlyReturn:"#yearly-return-value",assetsList:"#assets-list",chartSegment:"#chart-segment",walletSelection:"#wallet-selection",portfolioChart:"#portfolio-chart",sharpeChart:"#sharpe-chart",assetTemplate:"#asset-template"},CHART_COLORS=["#D1F767","#E8A005","#FF5343","#627EEA","#6c757d","#8B5CF6","#F59E0B","#10B981","#EF4444","#3B82F6"];async function initPortfolio(){try{await loadData(),createWalletButtons(),setActiveWallet(portfolioData.activeWalletId||portfolioData.wallets[0].id)}catch(t){console.error("Ошибка загрузки данных портфеля:",t)}}async function loadData(){const t=await fetch("/data/portfolio-data.json");if(!t.ok)throw new Error(`HTTP ошибка! статус: ${t.status}`);portfolioData=await t.json()}function createWalletButtons(){const t=document.querySelector(SELECTORS.walletSelection);if(!t)return;t.querySelectorAll("button").length>0&&(t.innerHTML=""),portfolioData.wallets.forEach(e=>{const a=document.createElement("button");a.className="btn btn-outline-dark rounded-pill px-4",a.textContent=e.name,a.setAttribute("data-wallet-id",e.id),a.onclick=()=>setActiveWallet(e.id),t.appendChild(a)})}function setActiveWallet(t){const e=portfolioData.wallets.find(e=>e.id===t);e&&(activeWalletId=t,updateUI(e),updateWalletButtons())}function updateWalletButtons(){document.querySelectorAll(`${SELECTORS.walletSelection} button`).forEach(t=>{const e=parseInt(t.getAttribute("data-wallet-id"))===activeWalletId;t.className=e?"btn btn-dark rounded-pill px-4":"btn btn-outline-dark rounded-pill px-4"})}function updateUI(t){updateElement(SELECTORS.portfolioValue,t.capital),updateElement(SELECTORS.chartValue,t.capital),updateElement(SELECTORS.portfolioStat,t.capital),updateElement(SELECTORS.winrateStat,t.winRate),updateElement(SELECTORS.annualReturnStat,t.annualReturn),updateElement(SELECTORS.yearlyReturn,t.yearlyReturn),updateAssetsList(t.assets),updateCircularChart(t.assets),updateChartImages(t)}function updateElement(t,e){const a=document.querySelector(t);a&&(a.textContent=e)}function updateAssetsList(t){const e=document.querySelector(SELECTORS.assetsList),a=document.querySelector(SELECTORS.assetTemplate);e&&a&&(e.innerHTML="",t.forEach(t=>{const n=a.content.cloneNode(!0),o=n.querySelector(".asset-icon-img");o.src=`./assets/icons/tokenico/${t.name}.png`,o.alt=t.name;n.querySelector(".text-white.small.fw-bold").textContent=t.name.charAt(0);n.querySelector(".asset-text").textContent=`${t.name} - ${t.percentage}%`,e.appendChild(n)}))}function updateCircularChart(t){const e=document.querySelector(SELECTORS.chartSegment);if(!e)return;let a=0;const n=t.map((t,e)=>{const n=3.6*a;a+=t.percentage;return`${CHART_COLORS[e]||CHART_COLORS[CHART_COLORS.length-1]} ${n}deg ${3.6*a}deg`}).join(", ");e.style.background=`conic-gradient(${n})`}function updateChartImages(t){const e=document.querySelector(SELECTORS.portfolioChart);e&&(e.src=t.portfolioChart);const a=document.querySelector(SELECTORS.sharpeChart);a&&(a.src=t.sharpeChart)}document.addEventListener("DOMContentLoaded",initPortfolio);